var l=e=>e/864e5;var a={badge:'[data-list-id="guildsnav"] [class^="numberBadge_"]',neverClearItem:'[data-list-id] [data-list-item-id$="___null"]',customStatusInput:'[role="dialog"] .input_d266e7',clearAfterButton:'[role="dialog"] .formGroup_b5ae3f:nth-child(2) [role="button"]',serverChatsList:"#channels > ul",serverChats:'[data-list-item-id^="private-channels-uid"]',serverCharTitleElement:".overflow__87fe8",navBar:'[data-list-id="guildsnav"]',servers:'[data-list-id="guildsnav"] > div[class^="scroller"] > div[aria-label] > div[class^="listItem"]',customStatusButton:"#account-set-custom-status, #account-edit-custom-status",submitStatusButton:'[role="dialog"] button.lookFilled__19298',userButton:".avatarWrapper_ba5175"};var m=(e,r)=>{if(!e.isLocalStorageItemExist(r))return;let s=document.querySelectorAll(a.badge).length;e.setBadge(s)};var u=e=>`No element for selector ${e}`;var p=e=>{let r=document.querySelectorAll(e.servers);return Array.from(r).map(s=>{let t=s.querySelector("[data-list-item-id^='guildsnav']");if(!t)throw Error(u("idItem"));let o=t.dataset.listItemId?.split("___")[1];if(!o)throw Error(u("channelId"));let n=s.querySelector("[data-dnd-name]")?.dataset.dndName;if(!n)throw Error(u("title"));return{channelId:o,title:n}})},d=async(e,r)=>{await e.waitMS(15e3);let s=document.querySelectorAll(r.serverChats);return Array.from(s).reduce((t,o)=>{let n=o.href,c=o.querySelector(r.serverCharTitleElement)?.innerText;return c?[...t,{link:n,title:c}]:t},[])};var b=async(e,r)=>{try{if(!e.isLocalStorageItemExist(r))return;(await d(e,a)).forEach(({link:t,title:o})=>e.putResource(t,{title:o}))}catch{let t=e.assert;t(!1,"Cant set chats resources")}};var f=e=>window.localStorage.getItem(e),y=(e,r)=>{window.localStorage.setItem(e,r)};var S=(e,r)=>{let s=new window.Event("mousedown",{bubbles:!0,cancelable:!0}),t=new window.Event("mouseup",{bubbles:!0,cancelable:!0}),o=new window.Event("click",{bubbles:!0,cancelable:!0});e.dispatchEvent(s),!document.querySelector(r)&&(e.dispatchEvent(o),!document.querySelector(r)&&e.dispatchEvent(t))};var w=async(e,r,s)=>{let t=await e.waitUntilElementExist(document,s.customStatusInput,r);if(!t)throw new Error(u("customStatusInput"));return t},E=async(e,r,s)=>{let t=await e.waitUntilElementExist(document,s.customStatusButton,r);if(!t)throw new Error(u("customStatusButton"));t.click()},g=async(e,r,s)=>{let t=await e.waitUntilElementExist(document,s.userButton,r);if(!t)throw new Error(u("userButton"));S(t,s.customStatusButton)},h=async(e,r,s)=>{let t=await e.waitUntilElementExist(document,s.submitStatusButton,r);if(!t)throw new Error(u("submitStatusButton"));t.click()},x=async(e,r,s)=>{let t=await e.waitUntilElementExist(document,s.clearAfterButton,r);if(!t)throw new Error(u("clearAfterButton"));t.click(),await e.waitMS(150);let o=t.getAttribute("aria-controls");if(!o)throw new Error;let n=await e.waitUntilElementExist(document,`#${o}`,r);if(!n)throw new Error(u("clearAfterPopup"));let c=await e.waitUntilElementExist(n,s.neverClearItem,r);if(!c)throw new Error(u("neverClearItem"));c.click()},v=(e,r)=>{e.value=r,e.dispatchEvent(new window.Event("input",{bubbles:!0,cancelable:!0}))};var A=async({statusText:e,force:r=!1,dontClearStatus:s=!1,sidekick:t,timeout:o})=>{try{if(!r&&f("sidekick.last_status_text")===e)return!1;await g(t,o,a),await E(t,o,a);let n=await w(t,o,a);return v(n,e),s&&await x(t,o,a),await h(t,o,a),y("sidekick.last_status_text",e),!0}catch{let c=t.assert;c(!1,"Focus mode is broken")}};var M=async(e,r,s)=>{try{if(!e.isLocalStorageItemExist(r))return;if(await e.waitDocReady(),!await e.waitUntilElementExist(document,a.navBar,s))throw new Error(u("navBarElement"));p(a).forEach(({title:n,channelId:c})=>e.putResource(`https://discord.com/channels/${c}`,{title:n}))}catch{let o=e.assert;o(!1,"Cant set servers resources")}};var T={authDomains:["discord.com"],hasFocusMode:!0,hasNotificationSound:!0,id:"discord",name:"Discord",onboardingGrade:13,startURL:"https://discord.com/channels/@me"};window.sidekick(e=>{let r="user_id_cache",t=null;e.observe(a.navBar,()=>m(e,r)),e.observe(a.serverChatsList,()=>b(e,r)),e.observe(a.navBar,()=>M(e,r,14e3)),e.subscribeFocusMode(async o=>{if(!e.isLocalStorageItemExist(r))return;let n=Date.now();if(t=n,await e.waitDocReady(),n!==t||o.shouldBeSilent&&(await e.waitPageWillBeHidden(),n!==t||(await e.waitPageWillBeVisible(),n!==t)))return;let c=Number(window.localStorage.getItem("sidekick.last_auto_sync_at")||""),i=o.runEveryDays&&l(Date.now()-c)>o.runEveryDays;await A({sidekick:e,timeout:14e3,dontClearStatus:Boolean(o.dontClearStatus),force:!!i,statusText:o.enabled?"Focus mode (via Sidekick Browser)":"Available (via Sidekick Browser)"})&&(e.triggerAnalyticEvent("content-script.focus-mode-changed",{"is-focus-mode-set":o.enabled,"recipe-id":T.id}),i&&window.localStorage.setItem("sidekick.last_auto_sync_at",JSON.stringify(Date.now())))})});

