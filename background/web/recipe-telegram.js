window.sidekick(e=>{let n=e.assert,t={badge:".chatlist > .chatlist-chat:not(.is-muted) .dialog-subtitle-badge.unread",container:"#chatlist-container",dialog:"div.chatlist-top > ul > a",dialogTitle:"span.peer-title",chatSection:"#main-columns .item-main.active"},a="user_auth",d=45e3,s=r=>`No element for selector ${r}`,m=()=>{if(!e.isLocalStorageItemExist(a)){e.setBadge(0);return}if(!document.querySelector(t.chatSection))return;let r=document.querySelectorAll(t.badge).length;e.setBadge(r)},i=async()=>{if(!e.isLocalStorageItemExist(a)||!document.querySelector(t.chatSection))return;let r=await e.waitUntilElementExist(document,t.dialog,d);n(!!r,s("dialog"),{extra:{url:document.URL,windowWidth:window.innerWidth}}),Array.from(document.querySelectorAll(t.dialog)).forEach(o=>{let l=o.querySelector(t.dialogTitle);n(!!l,s("dialogTitle"),{extra:{url:document.URL,windowWidth:window.innerWidth}});let c=l?.innerText;if(!c||!o.dataset.peerId||!o.hash)return;let u=new URL(document.location.href);u.hash=o.hash,e.putResource(u.toString(),{title:c})})};e.observe(`${t.container}, ${t.badge}`,m),e.observe(t.container,i,{debounceMs:15e3}),i().catch(console.error)});

