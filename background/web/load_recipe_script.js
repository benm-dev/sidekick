var k=t=>`recipe-${t}`;function ce(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var l=ce;var pe=typeof global=="object"&&global&&global.Object===Object&&global,F=pe;var de=typeof self=="object"&&self&&self.Object===Object&&self,ue=F||de||Function("return this")(),h=ue;var le=function(){return h.Date.now()},T=le;var me=/\s/;function ge(t){for(var e=t.length;e--&&me.test(t.charAt(e)););return e}var B=ge;var fe=/^\s+/;function be(t){return t&&t.slice(0,B(t)+1).replace(fe,"")}var D=be;var ye=h.Symbol,f=ye;var L=Object.prototype,Se=L.hasOwnProperty,Me=L.toString,M=f?f.toStringTag:void 0;function Ee(t){var e=Se.call(t,M),r=t[M];try{t[M]=void 0;var s=!0}catch{}var i=Me.call(t);return s&&(e?t[M]=r:delete t[M]),i}var $=Ee;var he=Object.prototype,Te=he.toString;function Re(t){return Te.call(t)}var H=Re;var Ce="[object Null]",ve="[object Undefined]",G=f?f.toStringTag:void 0;function xe(t){return t==null?t===void 0?ve:Ce:G&&G in Object(t)?$(t):H(t)}var W=xe;function Ae(t){return t!=null&&typeof t=="object"}var Q=Ae;var Oe="[object Symbol]";function Ue(t){return typeof t=="symbol"||Q(t)&&W(t)==Oe}var V=Ue;var q=0/0,_e=/^[-+]0x[0-9a-f]+$/i,we=/^0b[01]+$/i,Ne=/^0o[0-7]+$/i,Ie=parseInt;function je(t){if(typeof t=="number")return t;if(V(t))return q;if(l(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=l(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=D(t);var r=we.test(t);return r||Ne.test(t)?Ie(t.slice(2),r?2:8):_e.test(t)?q:+t}var w=je;var Pe="Expected a function",ke=Math.max,Fe=Math.min;function Be(t,e,r){var s,i,n,o,a,p,d=0,g=!1,y=!1,O=!0;if(typeof t!="function")throw new TypeError(Pe);e=w(e)||0,l(r)&&(g=!!r.leading,y="maxWait"in r,n=y?ke(w(r.maxWait)||0,e):n,O="trailing"in r?!!r.trailing:O);function U(c){var u=s,S=i;return s=i=void 0,d=c,o=t.apply(S,u),o}function ie(c){return d=c,a=setTimeout(E,e),g?U(c):o}function ne(c){var u=c-p,S=c-d,P=e-u;return y?Fe(P,n-S):P}function I(c){var u=c-p,S=c-d;return p===void 0||u>=e||u<0||y&&S>=n}function E(){var c=T();if(I(c))return j(c);a=setTimeout(E,ne(c))}function j(c){return a=void 0,O&&s?U(c):(s=i=void 0,o)}function oe(){a!==void 0&&clearTimeout(a),d=0,s=p=i=a=void 0}function ae(){return a===void 0?o:j(T())}function _(){var c=T(),u=I(c);if(s=arguments,i=this,p=c,u){if(a===void 0)return ie(p);if(y)return clearTimeout(a),a=setTimeout(E,e),U(p)}return a===void 0&&(a=setTimeout(E,e)),o}return _.cancel=oe,_.flush=ae,_}var J=Be;var m=(t,e,r=!0)=>r?Object.prototype.hasOwnProperty.call(t,e):e in t;var b=class extends Error{context;constructor(e,r={}){super(e),this.name="DetailedError",this.context=r,m(Error,"captureStackTrace")&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,this.constructor)}};var R=class extends b{constructor(e){super(e,{isSilent:!0}),this.name="AbortError"}};var Y=null;var K=(t,e=void 0)=>{console.error(t),Y&&Y.captureException(t,e)};var C=t=>{t instanceof Promise&&t.catch(K)};var X=t=>l(t)&&m(t,"type")&&(typeof t.type=="string"||typeof t.type=="number"),z=(t,e)=>m(t,"scriptName")&&t.scriptName===e;var Z=t=>t.type==="FOCUS_MODE";var ee=t=>t.type==="SEND_ANALYTICS";var te=t=>t.type==="CALL_CUSTOM_SUBSCRIBER";var v=class extends b{constructor(e,r,s){super(`[${e}]: ${r}`,{extra:s,tags:{recipeId:e}}),this.name="RecipeError"}};var De=t=>{let s=0,i,n=async()=>{try{s++,await t(),clearInterval(i)}catch(o){if(s>5)throw clearInterval(i),o}};i=window.setInterval(()=>{n().catch(console.error)},500)},x=class{constructor(e,r){this.api=e;this.recipeId=r;Object.getOwnPropertyNames(Object.getPrototypeOf(this)).forEach(s=>{this[s]instanceof Function&&s!=="constructor"&&(this[s]=this[s].bind(this))}),this.subscriptions.add(this.api.onMessage(s=>{Z(s)&&(this.focusModeState=s.payload,this.focusModeSubscribers.forEach(i=>C(i(this.focusModeState))))})),this.api.onUnload(()=>{this.unloaded||this.unload()})}currentBadgeValue;focusModeState=null;focusModeSubscribers=new Set;unloaded=!1;unloadSubscribers=new Set;subscriptions=new Set;assert(e,r="Assertion failed",{extra:s,clearBadges:i}={}){if(e)return;let n=new v(this.recipeId,r,s),o={type:"SEND_ERROR",error:{message:n.message,name:n.name,context:n.context,stack:n.stack}};throw i&&this.setBadge(0),this.api.sendMessage(o),n}addCustomSubscriber(e,r){let s={type:"SET_CUSTOM_SUBSCRIBER",name:e};this.api.sendMessage(s),this.unloadSubscribers.add(this.api.onMessage(i=>{!te(i)||i.name!==e||C(r(...i.args??[]))}))}callSubscribers(e,...r){let s={type:"CALL_CUSTOM_SUBSCRIBER",name:e,args:r};this.api.sendMessage(s)}injectToFrames(){this.api.sendMessage({type:"INJECT_FRAMES_REQUEST"})}assertSelectorResult(e,r){this.assert(e,r?`Missing selector: ${r}`:void 0)}expectSelector(e,r,s,i=`${r}: ${s}`){let n=e.querySelector(s);return this.assertSelectorResult(n,i),n}expectSelectorAll(e,r,s,i){let n=typeof s=="string"?s:s.join(", "),o=e.querySelectorAll(n);return this.assertSelectorResult(o.length,i??`${r}: ${n}`),Array.from(o)}observe(e,r,s={}){let i=()=>De(r),n=s.debounceMs?J(i,s.debounceMs):i,o=new MutationObserver(d=>{d.some(g=>g.target instanceof HTMLElement&&g.target.matches?.(e)||g.target.parentElement?.matches(e))&&n()}),a={attributes:!0,childList:!0,subtree:!0,characterData:!0};o.observe(document,a),i();let p=()=>o.disconnect();return this.api.onUnload(p),p}isLocalStorageItemExist(e){return m(localStorage,e)}isCookieExist(e){let r=`^(.*;)?\\s*${e}\\s*=\\s*[^;]+(.*)?$`;return new RegExp(r).test(document.cookie)}waitMS(e){return new Promise(r=>{setTimeout(r,e)})}waitDocReady(){return new Promise(e=>{if(document.readyState!=="loading"){e();return}let r=()=>{document.removeEventListener("DOMContentLoaded",r),e()};document.addEventListener("DOMContentLoaded",r)})}waitUntilElementExist(e,r,s){return new Promise((i,n)=>{let o=()=>{let p=Array.isArray(r)?r.join(", "):r.toString(),d=(e instanceof HTMLElement||e instanceof Document)&&e.querySelector(p);return d&&i(d),Boolean(d)};if(o())return;let a=new MutationObserver(p=>p.forEach(d=>{d.addedNodes&&o()&&a.disconnect()}));this.api.onUnload(()=>{a.disconnect(),n(new R("Script Api is unloaded"))}),s&&setTimeout(()=>{a.disconnect(),i(void 0)},s),a.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1})})}async waitPageWillBeHidden(){return this.waitPageVisibleState("hidden")}async waitPageWillBeVisible(){return this.waitPageVisibleState("visible")}putResource(e,{title:r="",favIconUrl:s}){if(this.api.isUnloaded)return;let i={type:"PUT_RESOURCE",url:e,title:r,favIconUrl:s};this.api.sendMessage(i)}setBadge(e){if(this.api.isUnloaded||this.currentBadgeValue&&this.currentBadgeValue===e)return;this.currentBadgeValue=e;let r={type:"BADGES",value:e};this.api.sendMessage(r)}setAccounts(e){if(this.api.isUnloaded)return;let r={type:"ACCOUNTS",accounts:e};this.api.sendMessage(r)}subscribeFocusMode(e){return this.focusModeState!==null?C(e(this.focusModeState)):this.api.sendMessage({type:"REQUEST_FOCUS_MODE_STATE"}),this.focusModeSubscribers.add(e),()=>{this.focusModeSubscribers.delete(e)}}triggerAnalyticEvent(e,r){let s={type:"SEND_ANALYTICS",name:e,payload:r};ee(s),this.api.sendMessage(s)}unload(){this.unloaded=!0,this.focusModeSubscribers.clear(),this.subscriptions.forEach(e=>e()),this.subscriptions.clear(),this.unloadSubscribers.forEach(e=>e()),this.unloadSubscribers.clear()}async waitPageVisibleState(e){return document.visibilityState===e?Promise.resolve():new Promise(r=>{let s=()=>{document.visibilityState===e&&(document.removeEventListener("visibilitychange",s,!1),r())};document.addEventListener("visibilitychange",s,!1)})}};var A=class{constructor(e){this.scriptName=e}isUnloaded=!1;destroyCallbacks=[];sendMessage(e){this.isUnloaded||chrome.runtime.sendMessage({...e,scriptName:this.scriptName})}onMessage(e){let r=s=>{!X(s)||!z(s,this.scriptName)||e(s)};return chrome.runtime.onMessage.addListener(r),()=>chrome.runtime.onMessage.removeListener(r)}unload(){this.destroyCallbacks.forEach(e=>e()),this.destroyCallbacks.length=0,this.isUnloaded=!0}onUnload(e){this.destroyCallbacks.push(e)}};var re="__sidekick_scripts",N=class{register(e){this.getScriptMap().set(e.scriptName,e)}getScriptMap(){let e=globalThis[re];if(e)return e;let r=new Map;return globalThis[re]=r,r}},se=new N;function Le(t,e){let r=new A(k(t)),s=new x(r,t);se.register(r),Object.assign(globalThis,{sidekick:n=>{let o=n(s);o instanceof Promise&&o.catch(console.error)}}),import(e)}export{Le as default};

