window.sidekick(t=>{let a={accountAvatar:"img",accountCurrent:".gb_nb",accountEmail:"div[class] > div:last-child",accountList:'a[href^="/webchat/start?authuser="]',accounts:'a[href^="/webchat/start?authuser="]',badge:".XU",chatsFromFrame:"div.teTAFe.IkYAKb.XFzPX > div:nth-child(2)"},u=45e3,r=t.assert,m=e=>`No element for selector ${e}`,i=()=>{let e=document.querySelector(a.badge);if(e){let o=Number.parseInt(e.innerText,10);t.setBadge(Number.isNaN(o)?0:o)}else t.setBadge(0)},h=async()=>{await t.waitUntilElementExist(document,a.accountList);let e=t.expectSelectorAll(document,"accountList",a.accountList),o=Array.from(e??[]).map(c=>{let n=t.expectSelector(c,"accountAvatar",a.accountAvatar),s=t.expectSelector(c,"accountEmail",a.accountEmail),f=t.expectSelector(document,"accountCurrent",a.accountCurrent),T=n.dataset.src||n.src,l=s.innerText,b=f.innerText===l;return{account:l,avatar:T,isCurrent:b}});t.setAccounts(o)},d=async()=>{let e=await t.waitUntilElementExist(document,a.chatsFromFrame,u);r(!!e,m("chatsFromFrame")),Array.from(e.childNodes).forEach(o=>{let c=o.dataset.groupId;r(!!c,"No id in chat");let n=o.querySelector("[data-name]");r(!!n,m("data-name"));let s=n.dataset.name;t.putResource(`https://mail.google.com/chat/u/0/#chat/${c}`,{title:s})})},E=()=>{let e=document.querySelectorAll("iframe");Array.from(e)?.some(o=>o.id==="gtn-roster-iframe-id")&&t.injectToFrames()},g=()=>window.location.hostname==="mail.google.com",A=()=>document.location.hash.startsWith("#hot");t.observe("iframe",E),g()&&(t.observe(a.badge,i),h().catch(console.error)),A()&&d().catch(console.error)});

